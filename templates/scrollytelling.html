<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scrolly-Telling with Dynamic Content</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
<!-- Store sections data in a script tag with type application/json -->
    <script id="sections-data" type="application/json">
        {{ sections | tojson }}
    </script>

    <script type="text/javascript">
        // Parse the JSON data from the script tag
        var sectionsData = JSON.parse(document.getElementById('sections-data').textContent);
        var staticUrl = "{{ url_for('static', filename='') }}";
    </script>
</head>
<body>

    <div class="container">
        <!-- Full-screen background image -->
        <div class="full-screen-image">
            <img src="{{ url_for('static', filename=sections[0].image) }}" alt="Map" id="background-image">
        </div>

        <!-- Loop through sections and render each text box -->
        {% for section in sections %}
        <div class="text-box" id="{{ section.id }}">
            <!-- Render text, allowing for HTML formatting (if used) -->
            <p>{{ section.text | safe }}</p>
        </div>
        {% endfor %}

    </div>

    <script>
        // Function to update the image based on the section in view
        function updateImage(sectionId) {
            const imageElement = document.querySelector('#background-image');
            const section = sectionsData.find(function(sec) {
                return sec.id === sectionId;
            });
            if (section) {
                imageElement.src = staticUrl + section.image;
            }
        }

        // IntersectionObserver to track which section is in view
        var options = {
            root: null, 
            threshold: 0.5 // Trigger when 50% of the section is in view
        };

        var observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    updateImage(entry.target.id);
                }
            });
        }, options);

        // Observe all text sections
        document.querySelectorAll('.text-box').forEach(function(section) {
            observer.observe(section);
        });
    </script>

</body>
</html>
